{"ast":null,"code":"import _extends from '@babel/runtime/helpers/extends';\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/objectWithoutPropertiesLoose';\nimport { fieldSubscriptionItems, ARRAY_ERROR, version as version$1 } from 'final-form';\nimport { useForm, useField, version as version$2 } from 'react-final-form';\nimport React__default, { createElement } from 'react'; // shared logic between components that use either render prop,\n// children render function, or component prop\n\nfunction renderComponent(props, name) {\n  var render = props.render,\n      children = props.children,\n      component = props.component,\n      rest = _objectWithoutPropertiesLoose(props, [\"render\", \"children\", \"component\"]);\n\n  if (component) {\n    return createElement(component, _extends({}, rest, {\n      children: children,\n      render: render\n    })); // inject children back in\n  }\n\n  if (render) {\n    return render(children === undefined ? rest : _extends({}, rest, {\n      children: children\n    })); // inject children back in\n  }\n\n  if (typeof children !== 'function') {\n    throw new Error(\"Must specify either a render prop, a render function as children, or a component prop to \" + name);\n  }\n\n  return children(rest);\n}\n\nvar defaultIsEqual = function defaultIsEqual(aArray, bArray) {\n  return aArray === bArray || Array.isArray(aArray) && Array.isArray(bArray) && aArray.length === bArray.length && !aArray.some(function (a, index) {\n    return a !== bArray[index];\n  });\n};\n/**\n * A simple hook to create a constant value that lives for\n * the lifetime of the component.\n *\n * Plagiarized from https://github.com/Andarist/use-constant\n *\n * Do NOT reuse this code unless you know what you're doing.\n * Use Andarist's hook; it's more fault tolerant to things like\n * falsy values.\n *\n * @param {Function} init - A function to generate the value\n */\n\n\nfunction useConstant(init) {\n  var ref = React__default.useRef();\n\n  if (!ref.current) {\n    ref.current = init();\n  }\n\n  return ref.current;\n}\n\nvar all = fieldSubscriptionItems.reduce(function (result, key) {\n  result[key] = true;\n  return result;\n}, {});\n\nvar useFieldArray = function useFieldArray(name, _temp) {\n  var _ref = _temp === void 0 ? {} : _temp,\n      _ref$subscription = _ref.subscription,\n      subscription = _ref$subscription === void 0 ? all : _ref$subscription,\n      defaultValue = _ref.defaultValue,\n      initialValue = _ref.initialValue,\n      _ref$isEqual = _ref.isEqual,\n      isEqual = _ref$isEqual === void 0 ? defaultIsEqual : _ref$isEqual,\n      validateProp = _ref.validate;\n\n  var form = useForm('useFieldArray');\n  var formMutators = form.mutators;\n  var hasMutators = !!(formMutators && formMutators.push && formMutators.pop);\n\n  if (!hasMutators) {\n    throw new Error('Array mutators not found. You need to provide the mutators from final-form-arrays to your form');\n  }\n\n  var mutators = useConstant(function () {\n    return (// curry the field name onto all mutator calls\n      Object.keys(formMutators).reduce(function (result, key) {\n        result[key] = function () {\n          for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n            args[_key] = arguments[_key];\n          }\n\n          return formMutators[key].apply(formMutators, [name].concat(args));\n        };\n\n        return result;\n      }, {})\n    );\n  });\n  var validate = useConstant(function () {\n    return function (value, allValues, meta) {\n      if (!validateProp) return undefined;\n      var error = validateProp(value, allValues, meta);\n\n      if (!error || Array.isArray(error)) {\n        return error;\n      } else {\n        var arrayError = [] // gross, but we have to set a string key on the array\n        ;\n        arrayError[ARRAY_ERROR] = error;\n        return arrayError;\n      }\n    };\n  });\n\n  var _useField = useField(name, {\n    subscription: _extends({}, subscription, {\n      length: true\n    }),\n    defaultValue: defaultValue,\n    initialValue: initialValue,\n    isEqual: isEqual,\n    validate: validate,\n    format: function format(v) {\n      return v;\n    }\n  }),\n      _useField$meta = _useField.meta,\n      length = _useField$meta.length,\n      meta = _objectWithoutPropertiesLoose(_useField$meta, [\"length\"]),\n      input = _useField.input,\n      fieldState = _objectWithoutPropertiesLoose(_useField, [\"meta\", \"input\"]);\n\n  var forEach = function forEach(iterator) {\n    // required || for Flow, but results in uncovered line in Jest/Istanbul\n    // istanbul ignore next\n    var len = length || 0;\n\n    for (var i = 0; i < len; i++) {\n      iterator(name + \"[\" + i + \"]\", i);\n    }\n  };\n\n  var map = function map(iterator) {\n    // required || for Flow, but results in uncovered line in Jest/Istanbul\n    // istanbul ignore next\n    var len = length || 0;\n    var results = [];\n\n    for (var i = 0; i < len; i++) {\n      results.push(iterator(name + \"[\" + i + \"]\", i));\n    }\n\n    return results;\n  };\n\n  return {\n    fields: _extends({\n      name: name,\n      forEach: forEach,\n      length: length || 0,\n      map: map\n    }, mutators, {}, fieldState, {\n      value: input.value\n    }),\n    meta: meta\n  };\n};\n\nvar version = \"3.1.1\";\nvar versions = {\n  'final-form': version$1,\n  'react-final-form': version$2,\n  'react-final-form-arrays': version\n};\n\nvar FieldArray = function FieldArray(_ref) {\n  var name = _ref.name,\n      subscription = _ref.subscription,\n      defaultValue = _ref.defaultValue,\n      initialValue = _ref.initialValue,\n      isEqual = _ref.isEqual,\n      validate = _ref.validate,\n      rest = _objectWithoutPropertiesLoose(_ref, [\"name\", \"subscription\", \"defaultValue\", \"initialValue\", \"isEqual\", \"validate\"]);\n\n  var _useFieldArray = useFieldArray(name, {\n    subscription: subscription,\n    defaultValue: defaultValue,\n    initialValue: initialValue,\n    isEqual: isEqual,\n    validate: validate\n  }),\n      fields = _useFieldArray.fields,\n      meta = _useFieldArray.meta;\n\n  return renderComponent(_extends({\n    fields: fields,\n    meta: _extends({}, meta, {\n      __versions: versions\n    })\n  }, rest), \"FieldArray(\" + name + \")\");\n};\n\nexport { FieldArray, useFieldArray, version };","map":null,"metadata":{},"sourceType":"module"}